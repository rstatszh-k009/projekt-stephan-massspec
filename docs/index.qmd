---
title: "index"
format: html
editor: visual
author: "Stephan Walker"
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
```

```{r}
# read_csv2 für ";" geteilte Tabelle
cortison_import <- read_csv2(here::here("daten/raw/Cortison_csv.csv"))
hydrocortison_import <- read_csv2(here::here("daten/raw/Hydrocortison_csv.csv"))
```

# Einleitung

Im Rahmen des Nationalen Fremdstoffuntersuchungs Programm (NFUP) wurden in Proben von tierischen Lebensmitteln die Rückstände von Cortison und Hydrocortison gemessen. Beide Substanzen kommen natürlich in Produkten tierischer Herkunft vor. Für die Substanzen gibt es abgesehen von Milch keine Grenzwerte oder sonstige Beurteilungskriterien.

## Daten

Resultate der im Rahmen des NFUP durchgeführten Messungen durch die Abteilung Tierarzneimittel Analytik des Kantonalen Labors Zürich.

## Analyseziele

Es soll gezeigt werden wie sich die Konzentrationen von Cortison und Hydrocortison in den mehr als 2000 Messungen verteilen.

Gibt es Unterschiede zwischen einzelnen Matrizes? z.B Muskel und Leber

Gibt es Unterschiede zwischen verschiedenen Tierarten? z.B. Rinder und Schweine

# Datenaufbereitung

Daten zusammenführen und Spaltentitel ändern

```{r}
# merge mit all = TRUE um auch Proben mit nur einem Resultat in der Tabelle zu behalten
cortison_beide <- merge(cortison_import, hydrocortison_import, by="ProbenID", all = TRUE)
# Konzentrationen als Zahl(numeric)
cortison_newname <- mutate(cortison_beide,
                           cortison_conc = as.numeric(ResultatResultat.x)) |> 
                  mutate(cortison_beide,
                           hydrocortison_conc = as.numeric(ResultatResultat.y))
 # ware und datum in einer Spalte auch wenn nur ein Wert gefunden                 
cortison_ware <- cortison_newname |> 
  mutate(ware = case_when(
    ProbeWare.x == is.character(ProbeWare.x) ~ ProbeWare.x,
    .default = ProbeWare.y
  ))

cortison_ware |> 
  count(ware)
                 
cortison_datum <- cortison_ware |> 
  mutate(datum = case_when(
    ProbeErhebungsdatum.x == is.character(ProbeErhebungsdatum.x) ~ ProbeErhebungsdatum.x,
    .default = ProbeErhebungsdatum.y
  ))

cortison_datum |> 
  count(datum)


# Datum formatieren
cortison_datum2 <-  mutate(cortison_datum, datum_date = as_date(datum, format = "%d.%m.%Y"))
                          
cortison_matrix <-  separate(cortison_datum2, ware,c("tierart","matrix"))


cortison_matrix |> 
  count(matrix)

```

```{r}
cortison_matrix2 <- cortison_matrix |> 
  mutate(matrix = case_when(
    matrix == "But" ~ "Blut",
    .default = matrix)) |> 
  mutate(matrix = case_when(
    matrix == "Urin" ~ "Harn",
    .default = matrix)) |> 
  mutate(tierart = case_when(
    tierart == "Schweine"~"Schwein",
    .default = tierart)
  )

cortison_matrix2 |> 
  count(matrix)

cortison_matrix2 |> 
  count(tierart)
```

Datum formatieren

```{r}
cortison_datum3 <- mutate(cortison_matrix2, monat = month(datum_date))
jahreszeiten <- c("Frühling","Sommer","Herbst","Winter")
cortison_datum4 <- mutate(cortison_datum3,
                          jahreszeit = case_when(
                            monat == c(3,4,5) ~ "Frühling",
                            monat == c(6,7,8) ~ "Sommer",
                            monat == c(9,10,11) ~ "Herbst",
                            monat == c(1,2,12) ~ "Winter"
                          ))



cortison_datum4 |> 
  count(matrix)

cortison_datum4 |> 
  count(matrix)
```

Untergruppen erstellen

```{r}
leber <- filter(cortison_datum3, matrix == "Leber")
niere <- filter(cortison_datum3, matrix == "Niere")
muskel <- filter(cortison_datum3, matrix == "Muskel")
```

Daten überprüfen

```{r}

```

# Daten Visualisierung

```{r}
ggplot(data = cortison_datum3,
       mapping = aes(x = matrix,
                     y = cortison_conc
                    
                     ))+
  geom_boxplot()

```

Nach Tierart

```{r}
ggplot(data = muskel,
       mapping = aes(x = cortison_conc,
                     y = hydrocortison_conc,
                     color = tierart))+
  geom_point()
```

Tabelle Muskel

```{r}
group_by(muskel, tierart) |> 
  summarise(n(),
            mean(cortison_conc), 
            min(cortison_conc), 
            max(cortison_conc), 
            mean(hydrocortison_conc),
            min(hydrocortison_conc),
            max(hydrocortison_conc))
```
